- provide(:donations, "active") 

- content_for :title_tag, "Donate to KeepNZGreen"

%script{ src: "https://checkout.stripe.com/checkout.js" }
%script{ src: "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" }

%section.main-content
  - if flash[:error].present?
    .error
      = flash[:error]

  - if flash[:message].present?
    .success
      = flash[:message]

  %h2 Donations

  %p
    Donations are accepted to help pay for the running of this website and all other expenses associated with the domain name keepnzgreen.com and keepnzgreen.co.nz. Receipts are automatically generated for tracking and tax purposes.
  %p
    Donations can be given as sponsorship money in exchange for advertising. Email me to discuss options. 
  %p
    Sponsorship money will be used to increase the web prescence of this site which results in more advertising exposure.

  %h3.m0 Donate to KeepNZGreen

  = form_tag donations_path, method: "post", class: "donation-form" do
    = label_tag "donation_amount" do
      = text_field_tag "donation_amount", "", placeholder: "100", type: "number", min: 1, max: 10000, class: "donate-field js-stripe-amount"
      dollars
      %br
    %button.js-stripe-button.mt10.btn-green Pay via Stripe

:javascript
  var handler = StripeCheckout.configure({
    key: "#{ENV['STRIPE_PUBLISHABLE_KEY']}",
    token: function(token, args) {
      var tokenInput = $("<input type='hidden' name='token'>").val(token.id);
      var emailInput = $("<input type=hidden name=stripe_email />").val(token.email);
      $(".donation-form").append(tokenInput).append(emailInput).submit();
      $(".donation-form").text("Updating...").attr("disabled", "disabled");
    }
  });

  $('.js-stripe-button').on('click', function(e) {
    handler.open({
      name: '&:conf',
      description: 'Donation',
      allowRememberMe: false,
      amount: $('.js-stripe-amount').val() * 100
    });
    e.preventDefault();
  });
